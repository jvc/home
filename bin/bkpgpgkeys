#!/bin/sh

if [ "$#" -ne 2 ]; then
    echo "Usage: $0 <key> <path>"
    exit 1
fi

if [ ! -d "$2" ]; then
    echo "No such directory: $2"
    exit 1
fi

stamp=$(date "+%Y%m%d")
key=$1
tdir=$2/$stamp

echo "Backing up to $tdir"

cp -a ~/.gnupg $tdir
gpg -a --export-secret-keys $key > $tdir/masterstubs.txt
gpg -a --export-secret-subkeys $key > $tdir/subkeysstubs.txt
gpg -a --export $key > $tdir/publickey.txt
